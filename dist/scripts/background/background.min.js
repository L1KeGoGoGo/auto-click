function showNotification(e){var t=e.m,n=e.t,o=void 0==e.i||""==e.i?"icon_128.png":e.i;e.u;chrome.notifications.create("Information",{type:"basic",iconUrl:o+".png",title:n,message:t}),chrome.notifications.onClicked.addListener(function(){void 0!=e.u&&""!=e.u&&chrome.tabs.create({url:e.u})})}function GetSavedItem(e){if(!savedItems[e]){var t=new Object;t.display=!0,t.folded=!0,savedItems[e]=t}return savedItems[e]}function CreateMenuItem(e,t,n){var o=new Object;return t.title&&t.title.length?o.title=t.title:o.title=t.url,o.contexts=defaultButtonVisibility,t.url?o.onclick=function(e,n){var o=GetBooleanFromStorage("OpenInTab"),r=GetBooleanFromStorage("OpenInBackground");OpenLink(n,t,o,r)}:o.onclick=function(e,n){if(0!=GetBooleanFromStorage("RightClickOpenFolder")){var o=GetBooleanFromStorage("OpenFolderInBackground");OpenAllLink(n,t,!0,o)}},e&&(o.parentId=e),chrome.contextMenus.create(o,function(){chrome.runtime.lastError&&console.log("Error creating menu item: "+chrome.runtime.lastError),n&&n()})}function ParseTree(e,t,n,o,r){for(var i in n){var a=n[i],c=o,s=GetSavedItem(a.id).display;!s||a.url&&!r||(c=CreateMenuItem(o,a),!e&&c&&AddChromeSpecific(e=c)),a.children&&(e=ParseTree(e,a.id,a.children,c,s)),!o&&e&&(o=e)}return r&&AddActions(t,o),e}function AddChromeSpecific(e){var t=GetBooleanFromStorage("DisplayAppLink");t&&chrome.contextMenus.create({title:chrome.i18n.getMessage("Title_AppLink"),parentId:e,onclick:OpenAppLink,contexts:defaultButtonVisibility}),t&&chrome.contextMenus.create({type:"separator",parentId:e,contexts:defaultButtonVisibility})}function AddOptions(e){var t=GetBooleanFromStorage("DisplayOptions"),n=GetBooleanFromStorage("DisplayRefresh"),o=GetBooleanFromStorage("DisplayBookmarkManager");(t||n||o)&&chrome.contextMenus.create({type:"separator",parentId:e,contexts:defaultButtonVisibility}),o&&chrome.contextMenus.create({title:chrome.i18n.getMessage("Title_ManageBookmarks"),parentId:e,onclick:OpenManager,contexts:defaultButtonVisibility}),t&&chrome.contextMenus.create({title:chrome.i18n.getMessage("Title_Options"),parentId:e,onclick:OpenOptions,contexts:defaultButtonVisibility}),n&&chrome.contextMenus.create({title:chrome.i18n.getMessage("Title_Refresh"),parentId:e,onclick:Refresh,contexts:defaultButtonVisibility})}function StartParseTree(e){var t=null;null==(t=ParseTree(t,e[0].id,e[0].children,null,!0))&&AddChromeSpecific(t),AddOptions(t),buildingMenu=!1,needRefresh&&Refresh()}function BuildMenu(){chrome.storage.local.get("BookmarksSetting",function(e){savedItems=e.BookmarksSetting,savedItems||(savedItems=new Object),chrome.bookmarks.getTree(StartParseTree)})}function requestHandler(e,t,n){Refresh()}function Refresh(){chrome.contextMenus.removeAll(BuildMenu)}chrome.runtime.onUpdateAvailable.addListener(function(e){console.log("updating to version "+e.version),chrome.runtime.reload()});var core={getOptions:function(){return console.log("getOptions",localStorage),localStorage}};window.onload=function(){chrome.extension.onRequest.addListener(function(e,t,n){n((core[e.action]||function(){}).apply(this,e.args))})},chrome.extension.onRequest.addListener(requestHandler);